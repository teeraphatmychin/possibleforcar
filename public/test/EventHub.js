cmsdefine(["Underscore","CMS/Application"],function(n,t){var i=window.top,u=window._,r,f=function(n){var u={},r={},h=1,f=function(t){return n.flatten(t,!0)},c=function(t){return n.toArray(t.parent.frames).indexOf(t)},l=function(t,e,o,s){var c,h;(n.isString(e)||(c=e,e=c.name),u[e]=u[e]||{},r[e]=r[e]||{},e&&o)&&(s=s||i,r[e][t]=r[e][t]||[],r[e][t].push({cb:o,ctx:s}),h=n.compose(f,n.toArray)(u[e]),h&&n.each(h,function(n){o.apply(s,n)}))},a=function(t,i,u){var s,f,e,o,h;n.isString(i)||(s=i,i=s.name);f=r[i]=r[i]||{};for(e in f)if(f.hasOwnProperty(e))for(o=0,h=f[e].length;o<h;o++)if(f[e][o].cb===u){f[e].splice(o,1);return}},v=function(n,i,r,u){for(var o=!0,f=n.length-1,e;o&&f>=0;)try{while(o&&f>=0)e=n[f],u&&!u.apply(e.ctx,i)?o=!1:e.cb.apply(e.ctx,i),f--}catch(s){console&&console.log&&(!t||t.getData("isDebuggingEnabled"))&&console.error('Event "'+r+'" fired an error:\n'+s+"\n"+s.stack);f--}},y=function(){var e=n.toArray(arguments),c=e[0],t=e[1],l=e.slice(2),o,s,i,a=null,y=!1;n.isString(t)||(i=t,t=i.name,a=i.checkContinue,y=i.onlySubscribed);u[t]=u[t]||{};r[t]=r[t]||{};y||(o=u[t][c]||[],o.unshift(l),u[t][c]=o.slice(0,h));s=n.compose(f,n.toArray)(r[t]);s&&v(s,l,t,a)},e=function(n,t,i){n.CMS=n.CMS||{};n.parent==null&&(n.parent=n.self);n.parent.CMS=n.parent.CMS||{};var r,u,f,o,h,l;return n.parent===n.self?(r=n.CMS.windowId,r||(r="0_0",t.push.apply(t,s(r)))):(r=n.CMS.windowId,u=n.parent.CMS.windowId,r||(u||(u=e(n.parent,t,!0)),f=u.split("|").pop().split("_"),o=f[0],h=parseInt(o,10)+1,l=c(n),r=u+"|"+h+"_"+l,i?t.push(r):t.push.apply(t,s(r)))),n.CMS.windowId=r,r},o=function(t,i){var r;n(t).each(function(n){for(r=i.length-1;r>=0;r--)delete n[i[r]]})},p=function(t,f){return function(){var s=n.toArray(arguments),c,l=s[0],h=[],a;n.isString(l)||(c=l,l=c.name,t=c.window||t);a=e(t,h,!1);h.length>0&&(o(u,h),o(r,h));s.push(t);s.unshift(a);f.apply(i.CMS.GlobalEventHub,s)}},s=function(t){return n(n(u).values().concat(n(r).values())).chain().map(n.keys).flatten().uniq().filter(function(n){return n.indexOf(t)===0}).value()};return{subscribe:l,unsubscribe:a,publish:y,generateLocalEventHubMethod:p}};return i.CMS=i.CMS||{},i.CMS.GlobalEventHub||(i.CMS.GlobalEventHub=f(u)),r=i.CMS.GlobalEventHub,{publish:r.generateLocalEventHubMethod(window,r.publish),subscribe:r.generateLocalEventHubMethod(window,r.subscribe),unsubscribe:r.generateLocalEventHubMethod(window,r.unsubscribe)}})